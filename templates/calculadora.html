{% extends "base.html" %}

{% block title %}Calculadoras Nutricionales{% endblock %}

{% block content %}
    <div class="container my-5">
        <h1 class="text-center text-success mb-5">Calculadoras Nutricionales</h1>
        
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">1. Tasa Metabólica Basal (TMB)</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="pesoTMB" class="form-label text-success">Peso (kg):</label>
                        <input type="number" id="pesoTMB" class="form-control" placeholder="Ej: 70" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="alturaTMB" class="form-label text-success">Altura (cm):</label>
                        <input type="number" id="alturaTMB" class="form-control" placeholder="Ej: 175" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="edadTMB" class="form-label text-success">Edad (años):</label>
                        <input type="number" id="edadTMB" class="form-control" placeholder="Ej: 30" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="generoTMB" class="form-label text-success">Género:</label>
                        <select id="generoTMB" class="form-select">
                            <option value="hombre">Hombre</option>
                            <option value="mujer">Mujer</option>
                        </select>
                    </div>
                </div>
                <button onclick="calcularTMB()" class="btn btn-success w-100">Calcular TMB</button>
                <div class="mt-3 p-3 bg-light rounded border border-success">
                    <p class="mb-0 text-success">Resultado TMB:</p>
                    <strong id="resultadoTMB" class="h4">0 kcal/día</strong>
                </div>
            </div>
        </div>
        
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">2. Gasto Calórico Total (GCT) / Calorías Diarias</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="pesoGCT" class="form-label text-success">Peso (kg):</label>
                        <input type="number" id="pesoGCT" class="form-control" placeholder="Ej: 70" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="alturaGCT" class="form-label text-success">Altura (cm):</label>
                        <input type="number" id="alturaGCT" class="form-control" placeholder="Ej: 175" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="edadGCT" class="form-label text-success">Edad (años):</label>
                        <input type="number" id="edadGCT" class="form-control" placeholder="Ej: 30" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="generoGCT" class="form-label text-success">Género:</label>
                        <select id="generoGCT" class="form-select">
                            <option value="hombre">Hombre</option>
                            <option value="mujer">Mujer</option>
                        </select>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="actividadGCT" class="form-label text-success">Nivel de Actividad:</label>
                    <select id="actividadGCT" class="form-select">
                        <option value="1.2">1. Sedentario (poco o ningún ejercicio)</option>
                        <option value="1.375">2. Ligero (ejercicio 1-3 días/semana)</option>
                        <option value="1.55">3. Moderado (ejercicio 3-5 días/semana)</option>
                        <option value="1.725">4. Alto (ejercicio 6-7 días/semana)</option>
                        <option value="1.9">5. Muy Alto (ejercicio intenso diario)</option>
                    </select>
                </div>
        
                <button onclick="calcularGCT()" class="btn btn-success w-100">Calcular GCT</button>
        
                <div class="mt-3 p-3 bg-light rounded border border-success">
                    <p class="mb-0 text-success">Resultado GCT (Calorías Mantenimiento):</p>
                    <strong id="resultadoGCT" class="h4">0 kcal/día</strong>
                </div>
            </div>
        </div>
        
        
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">3. Índice de Masa Corporal (IMC)</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="pesoIMC" class="form-label text-success">Peso (kg):</label>
                        <input type="number" id="pesoIMC" class="form-control" placeholder="Ej: 70" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="alturaIMC" class="form-label text-success">Altura (cm):</label>
                        <input type="number" id="alturaIMC" class="form-control" placeholder="Ej: 175" required>
                    </div>
                </div>
                <button onclick="calcularIMC()" class="btn btn-success w-100">Calcular IMC</button>
                <div class="mt-3 p-3 bg-light rounded border border-success">
                    <p class="mb-0 text-success">Resultado IMC:</p>
                    <strong id="resultadoIMC" class="h4">0.00</strong>
                    <span id="clasificacionIMC"></span>
                </div>
            </div>
        </div>

        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">4. Distribución de Macronutrientes (Macros)</h2>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="caloriasMacros" class="form-label text-success">Total de Calorías Diarias (kcal):</label>
                    <input type="number" id="caloriasMacros" class="form-control" placeholder="Ej: 2000" required>
                </div>
                <div class="mb-3">
                    <label for="distribucionMacros" class="form-label text-success">Distribución (P/C/G):</label>
                    <select id="distribucionMacros" class="form-select">
                        <option value="30/40/30">Estándar (30% Prot / 40% Carb / 30% Gras)</option>
                        <option value="40/30/30">Alta en Proteína (40% Prot / 30% Carb / 30% Gras)</option>
                        <option value="20/50/30">Alto Carbohidrato (20% Prot / 50% Carb / 30% Gras)</option>
                    </select>
                </div>
                <button onclick="calcularMacros()" class="btn btn-success w-100">Calcular Macros</button>
                <div class="mt-3 p-3 bg-light rounded border border-success">
                    <p class="mb-0 text-success">Resultado Gramos:</p>
                    <strong id="resultadoMacros" class="h6"></strong>
                </div>
            </div>
        </div>

        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">5. Peso Ideal</h2>
            </div>
        
            <div class="card-body">
        
                <div class="mb-3">
                    <label for="generoPesoIdeal" class="form-label text-success">Género:</label>
                    <select id="generoPesoIdeal" class="form-select">
                        <option value="H">Hombre</option>
                        <option value="M">Mujer</option>
                    </select>
                </div>
        
                <div class="mb-3">
                    <label for="alturaPesoIdeal" class="form-label text-success">Altura (cm):</label>
                    <input type="number" id="alturaPesoIdeal" class="form-control" placeholder="Ej: 170" required>
                </div>
        
                <button onclick="calcularPesoIdeal()" class="btn btn-success w-100">
                    Calcular Peso Ideal
                </button>
        
                <div class="mt-3 p-3 bg-light rounded border border-success">
                    <p class="mb-0 text-success">Peso Ideal Estimado:</p>
                    <strong id="resultadoPesoIdeal" class="h4">0 kg</strong>
                </div>
        
            </div>
        </div>
        
        <script>
        function calcularPesoIdeal() {
            const genero = document.getElementById("generoPesoIdeal").value;
            const altura = parseFloat(document.getElementById("alturaPesoIdeal").value);
        
            if (!altura || altura <= 0) {
                document.getElementById("resultadoPesoIdeal").textContent = "Datos inválidos";
                return;
            }
        
            const pulgadas = altura / 2.54;
            const base = 60;
            let peso;
        
            if (genero === "H") {
                peso = 50 + 2.3 * (pulgadas - base);
            } else {
                peso = 45.5 + 2.3 * (pulgadas - base);
            }
        
            document.getElementById("resultadoPesoIdeal").textContent = 
                Math.max(peso, 0).toFixed(1) + " kg";
        }
        </script>
        
        

        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">6. Requerimiento de Agua (Hidratación)</h2>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="pesoAgua" class="form-label text-success">Peso (kg):</label>
                    <input type="number" id="pesoAgua" class="form-control" placeholder="Ej: 70" required>
                </div>
                <button onclick="calcularAgua()" class="btn btn-success w-100">Calcular Agua</button>
                <div class="mt-3 p-3 bg-light rounded border border-success">
                    <p class="mb-0 text-success">Resultado Mínimo Diario:</p>
                    <strong id="resultadoAgua" class="h4">0.00 L</strong>
                    <p class="mt-2 text-secondary mb-0">(Esta es una estimación base que no considera ejercicio intenso o clima caluroso)</p>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block scripts %}
    <script>
        function obtenerValor(id) {
            const valor = parseFloat(document.getElementById(id).value);
            if (isNaN(valor)) {
                return null;
            }
            return valor;
        }
        

        function calcularTMB() {
            const peso = obtenerValor('pesoTMB');
            const altura = obtenerValor('alturaTMB');
            const edad = obtenerValor('edadTMB');
            const genero = document.getElementById('generoTMB').value;
            let tmb = 0;

            if (!peso || !altura || !edad) {
                document.getElementById('resultadoTMB').textContent = "Error: Ingrese valores válidos.";
                return;
            }

            if (genero === 'hombre') {
                tmb = 66 + (13.7 * peso) + (5 * altura) - (6.8 * edad);
            } else {
                tmb = 655 + (9.6 * peso) + (1.8 * altura) - (4.7 * edad);
            }

            document.getElementById('resultadoTMB').textContent = `${Math.round(tmb)} kcal/día`;
        }

        function calcularGET() {
            const peso = obtenerValor('pesoGET');
            const altura = obtenerValor('alturaGET');
            const edad = obtenerValor('edadGET');
            const genero = document.getElementById('generoGET').value;
            const factorActividad = parseFloat(document.getElementById('actividadGET').value);
            let tmb = 0;

            if (!peso || !altura || !edad) {
                document.getElementById('resultadoGET').textContent = "Error: Ingrese valores válidos.";
                return;
            }

            if (genero === 'hombre') {
                tmb = 66 + (13.7 * peso) + (5 * altura) - (6.8 * edad);
            } else {
                tmb = 655 + (9.6 * peso) + (1.8 * altura) - (4.7 * edad);
            }

            const get = tmb * factorActividad;
            document.getElementById('resultadoGET').textContent = `${Math.round(get)} kcal/día`;
        }

        function calcularIMC() {
            const peso = obtenerValor('pesoIMC');
            const alturaCm = obtenerValor('alturaIMC');
            
            if (!peso || !alturaCm) {
                document.getElementById('resultadoIMC').textContent = "Error: Ingrese valores válidos.";
                document.getElementById('clasificacionIMC').textContent = "";
                return;
            }
            
            const alturaM = alturaCm / 100;
            const imc = peso / (alturaM * alturaM); 
            
            let clasificacion = '';
            if (imc < 18.5) {
                clasificacion = '(Bajo Peso)';
            } else if (imc >= 18.5 && imc < 25) {
                clasificacion = '(Peso Saludable)';
            } else if (imc >= 25 && imc < 30) {
                clasificacion = '(Sobrepeso)';
            } else {
                clasificacion = '(Obesidad)';
            }

            document.getElementById('resultadoIMC').textContent = `${imc.toFixed(2)} `;
            document.getElementById('clasificacionIMC').textContent = clasificacion;
        }

        function calcularMacros() {
            const totalCalorias = obtenerValor('caloriasMacros');
            const distribucionStr = document.getElementById('distribucionMacros').value;
            
            if (!totalCalorias) {
                document.getElementById('resultadoMacros').innerHTML = "Error: Ingrese las calorías totales.";
                return;
            }

            const [p, c, g] = distribucionStr.split('/').map(val => parseFloat(val) / 100);

            const protGramos = Math.round((totalCalorias * p) / 4);
            const carbGramos = Math.round((totalCalorias * c) / 4);
            const grasaGramos = Math.round((totalCalorias * g) / 9);

            document.getElementById('resultadoMacros').innerHTML = `
                <p class="mb-1">Proteínas: <strong>${protGramos} g</strong> (${(p*100).toFixed(0)}%)</p>
                <p class="mb-1">Carbohidratos: <strong>${carbGramos} g</strong> (${(c*100).toFixed(0)}%)</p>
                <p class="mb-1">Grasas: <strong>${grasaGramos} g</strong> (${(g*100).toFixed(0)}%)</p>
            `;
        }

        function calcularGrasa() {
            const genero = document.getElementById('generoGrasa').value;
            const altura = obtenerValor('alturaGrasa');
            const cuello = obtenerValor('cuelloGrasa');
            const cintura = obtenerValor('cinturaGrasa');
            let cadera = 0;
            let porcentajeGrasa = 0;

            if (!altura || !cuello || !cintura) {
                document.getElementById('resultadoGrasa').textContent = "Error: Ingrese valores válidos.";
                return;
            }

            if (genero === 'H') {
                porcentajeGrasa = (495 / (1.0324 - 0.19077 * Math.log10(cintura - cuello) + 0.15456 * Math.log10(altura))) - 450;
            } else {
                cadera = obtenerValor('caderaGrasa');
                if (!cadera) {
                    document.getElementById('resultadoGrasa').textContent = "Error: Ingrese Cadera para mujeres.";
                    return;
                }

                porcentajeGrasa = (495 / (1.29579 - 0.35004 * Math.log10(cintura + cadera - cuello) + 0.22100 * Math.log10(altura))) - 450;
            }

            if (porcentajeGrasa < 5) {
                porcentajeGrasa = 5.00;
            }

            document.getElementById('resultadoGrasa').textContent = `${porcentajeGrasa.toFixed(2)}%`;
        }

        function calcularAgua() {
            const peso = obtenerValor('pesoAgua');

            if (!peso) {
                document.getElementById('resultadoAgua').textContent = "Error: Ingrese el peso.";
                return;
            }

            const mlDiarios = peso * 33; 
            const litrosDiarios = mlDiarios / 1000;

            document.getElementById('resultadoAgua').textContent = `${litrosDiarios.toFixed(2)} L`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const generoGrasaSelect = document.getElementById('generoGrasa');
            const caderaInput = document.querySelector('.mujer-solo');

            const toggleCadera = () => {
                if (generoGrasaSelect.value === 'H') {
                    caderaInput.style.display = 'none';
                } else {
                    caderaInput.style.display = 'block';
                }
            };

            toggleCadera();
            generoGrasaSelect.addEventListener('change', toggleCadera);
        });
    </script>
{% endblock %}

